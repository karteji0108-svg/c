<!-- TARUH script ini DI BAWAH (sebelum </body>) menggantikan script login localStorage kamu -->
<script type="module">
  // Firebase SDK (v9+ modular)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

  // 1) WAJIB: ganti pakai config punyamu
  const firebaseConfig = {
    apiKey: "ISI_API_KEY",
    authDomain: "ISI_AUTH_DOMAIN",
    projectId: "ISI_PROJECT_ID",
    appId: "ISI_APP_ID",
  };

  // 2) Init
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // 3) Toast helper (pakai punyamu)
  function showToast(type, message = '') {
    const successToast = document.getElementById('toast-success');
    const errorToast = document.getElementById('toast-error');

    if (type === 'success') {
      successToast.classList.remove('translate-y-[-150%]');
      setTimeout(() => successToast.classList.add('translate-y-[-150%]'), 3000);
    } else {
      document.getElementById('error-message').innerText = message;
      errorToast.classList.remove('translate-y-[-150%]');
      setTimeout(() => errorToast.classList.add('translate-y-[-150%]'), 3000);
    }
  }

  // 4) Login handler (Firebase Auth)
  document.getElementById('login-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value;
    const btn = document.getElementById('btn-submit');
    const originalBtnText = btn.innerHTML;

    btn.disabled = true;
    btn.innerHTML = `<span class="animate-spin border-2 border-white/30 border-t-white rounded-full w-5 h-5"></span>`;

    try {
      const cred = await signInWithEmailAndPassword(auth, email, password);

      // Simpan user minimal di localStorage kalau mau (opsional)
      localStorage.setItem('current_karteji_user', JSON.stringify({
        uid: cred.user.uid,
        email: cred.user.email
      }));

      showToast('success');

      setTimeout(() => {
        window.location.href = 'dashboard.html';
      }, 1200);

    } catch (err) {
      // Mapping error biar enak dibaca
      let msg = "Gagal login.";
      if (err.code === "auth/invalid-credential") msg = "Email atau password salah.";
      if (err.code === "auth/user-not-found") msg = "Akun tidak ditemukan.";
      if (err.code === "auth/wrong-password") msg = "Password salah.";
      if (err.code === "auth/too-many-requests") msg = "Terlalu banyak percobaan. Coba lagi nanti.";
      if (err.code === "auth/network-request-failed") msg = "Jaringan bermasalah / diblokir.";

      showToast('error', msg);
      btn.disabled = false;
      btn.innerHTML = originalBtnText;

      console.error("Firebase login error:", err);
    }
  });
</script>
